% Helper to map case id to label
\newcommand{\getScalingCaseName}[1]{%
  \ifnum#1=1 Insertion\fi%
  \ifnum#1=3 Deletion\fi%
  \ifnum#1=6 Positive Query\fi%
  \ifnum#1=7 Negative Query\fi%
}

% Helper to add all 6 objects with consistent styles
\newcommand{\AddAllObjectsForDataSize}[1]{%
  % \htthree (6)
  \addplot[CuckooLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{6:6},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
  % \htfour (7)
  \addplot[IcebergLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{7:7},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
  % \htfive (15)
  \addplot[JunctionLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{15:15},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
  % \htsix (24)
  \addplot[TBBLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{24:24},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
  % \htone (17)
  \addplot[TPHTLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{17:17},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
  % \httwo (20)
  \addplot[BlastLineStyle] table[
    x=table_size,
    y expr=\thisrow{throughput (ops/s)}/1000000,
    restrict expr to domain={\thisrow{case_id}}{#1:#1},
    restrict expr to domain={\thisrow{object_id}}{20:20},
    restrict expr to domain={\thisrow{table_size}}{32768:1000000000}
  ] {\datasizedata};
}

% Shared legend (reuse scaling legend styles)
\begin{figure*}[h]
  \centering
%   {\pgfplotslegendfromname{spaceeff-legend}}
  % Case 1
  \begin{subfigure}[b]{0.27\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=5cm,
        height=3.2cm,
        xlabel={Dataset Size (MB)},
        ylabel={Throughput (M/s)},
        xmode=log,
        log basis x=2,
        xmin=131072,
        xmax=268435456,
        xtick={262144,2097152,16777216,134217728},
        xticklabels={4,32,256,2048},
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{1}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{1}}
  \end{subfigure}%
  % Case 3
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=5cm,
        height=3.2cm,
        xlabel={Dataset Size (MB)},
        % ylabel={Throughput (M/s)},
        xmode=log,
        log basis x=2,
        xmin=131072,
        xmax=268435456,
        xtick={262144,2097152,16777216,134217728},
        xticklabels={4,32,256,2048},
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{3}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{3}}
  \end{subfigure}%
  % Case 6
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=5cm,
        height=3.2cm,
        xlabel={Dataset Size (MB)},
        % ylabel={Throughput (M/s)},
        xmode=log,
        log basis x=2,
        xmin=131072,
        xmax=268435456,
        xtick={262144,2097152,16777216,134217728},
        xticklabels={4,32,256,2048},
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{6}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{6}}
  \end{subfigure}%
  % Case 7
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
        width=5cm,
        height=3.2cm,
        xlabel={Dataset Size (MB)},
        % ylabel={Throughput (M/s)},
        xmode=log,
        log basis x=2,
        xmin=131072,
        xmax=268435456,
        xtick={262144,2097152,16777216,134217728},
        xticklabels={4,32,256,2048},
        grid=major,
        grid style={gray!30},
        tick label style={font=\small},
        label style={font=\small},
        scaled ticks=true,
        tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
      ]
      \AddAllObjectsForDataSize{7}
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{7}}
  \end{subfigure}%
  \caption{Performance scaling analysis for hash tables with increasing dataset size, single-threaded.}
  \label{fig:data_size_scaling}
\end{figure*}
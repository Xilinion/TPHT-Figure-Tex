% Helper to map case id to label
\newcommand{\getScalingCaseName}[1]{%
  \ifnum#1=1 Insertion\fi%
  \ifnum#1=3 Deletion\fi%
  \ifnum#1=9 Positive Query\fi%
  \ifnum#1=10 Negative Query\fi%
}

% Helper to add all 6 objects with consistent styles
\newcommand{\AddAllObjectsForDataSize}[1]{%
  % \htthree (6)
  \addplot[CuckooLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{6:6}
    ] {\datasizedata};
  % \htfour (7)
  \addplot[IcebergLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{7:7}
    ] {\datasizedata};
  % \htfive (15)
  \addplot[JunctionLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{15:15}
    ] {\datasizedata};
  % \htsix (24)
  \addplot[TBBLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{24:24}
    ] {\datasizedata};
  % \htone (17)
  \addplot[TPHTLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{17:17}
    ] {\datasizedata};
  % \httwo (20)
  \addplot[BlastLineStyle] table[
      x=table_size,
      y expr=\thisrow{throughput (ops/s)}/1000000,
      restrict expr to domain={\thisrow{case_id}}{#1:#1},
      restrict expr to domain={\thisrow{object_id}}{20:20}
    ] {\datasizedata};
}

% Axis break zigzag macro (draws on x-axis between positions 0 and 1)
% \newcommand{\DrawAxisBreakZigzag}{%
%   \draw[white, line width=4pt] (axis cs:0.5,0) +(-6pt,-4pt) rectangle +(6pt,4pt);
%   \draw[thick] (axis cs:0.5,0) +(-5pt,-3pt) -- +(-2pt,3pt) -- +(2pt,-3pt) -- +(5pt,3pt);
% }
% % Axis break zigzag macro
\newcommand{\DrawAxisBreakZigzag}{%
  % 1. Reduced eraser width from 8pt to 5pt to match the zigzag exactly
  \fill[white] (axis cs:0.5,0) +(-3pt,-3pt) rectangle +(3pt,3pt);
  % 2. The zigzag (unchanged)
  \draw (axis cs:0.5,0) +(-3pt, 0pt) -- +(-1pt,2pt) -- +(1pt,-2pt) -- +(3pt,0pt);
}

% Shared legend (reuse scaling legend styles)
\begin{figure*}[h]
  \centering
  {\pgfplotslegendfromname{spaceeff-legend}}
  % Case 1
  \begin{subfigure}[b]{0.27\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
          clip=false,
          width=5cm,
          height=3.2cm,
          xlabel={Dataset Size (MB)},
          ylabel={Throughput (M/s)},
          ymin=0,
          xmin=-0.5,
          xmax=4.5,
          xtick={0,1,2,3,4},
          xticklabels={1/32,4,32,256,2048},
          x filter/.expression={
            (x < 100000 ? 0 :
            (x < 1000000 ? 1 :
            (x < 10000000 ? 2 :
            (x < 100000000 ? 3 : 4))))
          },
          grid=major,
          grid style={gray!30},
          tick label style={font=\small},
          label style={font=\small},
          scaled ticks=true,
          tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
        ]
        \AddAllObjectsForDataSize{1}
        \DrawAxisBreakZigzag
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{1}}
  \end{subfigure}%
  % Case 3
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
          clip=false,
          width=5cm,
          height=3.2cm,
          xlabel={Dataset Size (MB)},
          % ylabel={Throughput (M/s)},
          ymin=0,
          xmin=-0.5,
          xmax=4.5,
          xtick={0,1,2,3,4},
          xticklabels={1/32,4,32,256,2048},
          x filter/.expression={
            (x < 100000 ? 0 :
            (x < 1000000 ? 1 :
            (x < 10000000 ? 2 :
            (x < 100000000 ? 3 : 4))))
          },
          grid=major,
          grid style={gray!30},
          tick label style={font=\small},
          label style={font=\small},
          scaled ticks=true,
          tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
        ]
        \AddAllObjectsForDataSize{3}
        \DrawAxisBreakZigzag
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{3}}
  \end{subfigure}%
  % Case 6
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
          clip=false,
          width=5cm,
          height=3.2cm,
          xlabel={Dataset Size (MB)},
          % ylabel={Throughput (M/s)},
          ymin=0,
          xmin=-0.5,
          xmax=4.5,
          xtick={0,1,2,3,4},
          xticklabels={1/32,4,32,256,2048},
          x filter/.expression={
            (x < 100000 ? 0 :
            (x < 1000000 ? 1 :
            (x < 10000000 ? 2 :
            (x < 100000000 ? 3 : 4))))
          },
          grid=major,
          grid style={gray!30},
          tick label style={font=\small},
          label style={font=\small},
          scaled ticks=true,
          tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
        ]
        \AddAllObjectsForDataSize{9}
        \DrawAxisBreakZigzag
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{9}}
  \end{subfigure}%
  % Case 7
  \begin{subfigure}[b]{0.24\textwidth}
    \tiny
    \centering
    \begin{tikzpicture}
      \begin{axis}[
          clip=false,
          width=5cm,
          height=3.2cm,
          xlabel={Dataset Size (MB)},
          % ylabel={Throughput (M/s)},
          ymin=0,
          xmin=-0.5,
          xmax=4.5,
          xtick={0,1,2,3,4},
          xticklabels={1/32,4,32,256,2048},
          x filter/.expression={
            (x < 100000 ? 0 :
            (x < 1000000 ? 1 :
            (x < 10000000 ? 2 :
            (x < 100000000 ? 3 : 4))))
          },
          grid=major,
          grid style={gray!30},
          tick label style={font=\small},
          label style={font=\small},
          scaled ticks=true,
          tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
        ]
        \AddAllObjectsForDataSize{10}
        \DrawAxisBreakZigzag
      \end{axis}
    \end{tikzpicture}
    \caption{\getScalingCaseName{10}}
  \end{subfigure}%
  \caption{Performance scaling analysis for hash tables with increasing dataset size, single-threaded.}\label{fig:data_size_scaling}
\end{figure*}
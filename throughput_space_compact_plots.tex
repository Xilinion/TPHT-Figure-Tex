\pgfplotsset{
    spaceeff compact axis/.style={
            width=6.2cm,
            height=3.7cm,
            xlabel={Space Efficiency},
            xmin=0,
            ymin=0,
            grid=major,
            grid style={gray!30},
            tick label style={font=\small},
            label style={font=\small},
            scaled ticks=true,
            tick label style={/pgf/number format/fixed,/pgf/number format/precision=2},
            xtick distance=0.2,
            minor tick num=1
        },
    spaceeff compact axis with ylabel/.style={
            spaceeff compact axis,
            ylabel={Throughput (M/s)}
        }
}

\newcommand{\PlotCompactObj}[4]{% style, obj_id, case_id, data
    \addplot[#1] table[
            x=space_efficiency,
            y=throughput_millions,
            restrict expr to domain={\thisrow{object_id}}{#2:#2},
            restrict expr to domain={\thisrow{case_id}}{#3:#3}
        ] {#4};
}

% Plot all compact objects for a given case_id; optional flag to exclude obj26.
\newcommand{\AddAllCompactPlotsForCase}[1]{%
    % Always plot these
    \PlotCompactObj{TPHTLineStyle}{4}{#1}{\throughputcompactdata}%
    \PlotCompactObj{BlastLineStyle}{23}{#1}{\throughputcompactdata}%
    \PlotCompactObj{IcebergLineStyle}{27}{#1}{\throughputcompactdata}%
    \PlotCompactObj{JunctionLineStyle}{28}{#1}{\throughputcompactdata}%
    \PlotCompactObj{TBBLineStyle}{29}{#1}{\throughputcompactdata}%
    \PlotCompactObj{BackupLineStyleOne}{30}{#1}{\throughputcompactdata}%
    \PlotCompactObj{BackupLineStyleTwo}{31}{#1}{\throughputcompactdata}%
    \PlotCompactObj{CuckooLineStyle}{26}{#1}{\throughputcompactdata}%
}

\begin{figure*}[h]
    \centering
    {\pgfplotslegendfromname{spaceeff-legend-compact}}

    \begin{subfigure}[b]{0.35\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[spaceeff compact axis with ylabel, legend to name={spaceeff-legend-compact}, legend entries={TPHT, Blast, Bucket, Group, Cleary$^{plain}$, Cleary$^{sparse}$, Layered$^{plain}$, Layered$^{sparse}$}, legend cell align=left, legend style={draw=none, legend columns=4, /tikz/every even column/.append style={column sep=0.4cm}}]
                \AddAllCompactPlotsForCase{1}
            \end{axis}
        \end{tikzpicture}
        \caption{Insertion}\label{fig:throughput_space_efficiency_compact/insertion}
    \end{subfigure}%
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[spaceeff compact axis]
                \AddAllCompactPlotsForCase{9}
            \end{axis}
        \end{tikzpicture}
        \caption{Positive Query}\label{fig:throughput_space_efficiency_compact/positive_query}
    \end{subfigure}%
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[spaceeff compact axis]
                \AddAllCompactPlotsForCase{10}
            \end{axis}
        \end{tikzpicture}
        \caption{Negative Query}\label{fig:throughput_space_efficiency_compact/negative_query}
    \end{subfigure}

    \caption{Throughput-space efficiency tradeoff for compact hash tables.}\label{fig:throughput_space_efficiency_compact_cases}
\end{figure*}

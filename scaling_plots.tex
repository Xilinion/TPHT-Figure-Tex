% Function to map case numbers to descriptive names
\newcommand{\getCaseName}[1]{%
    \ifnum#1=1 Insertion\fi%
    \ifnum#1=3 Deletion\fi%
    \ifnum#1=6 Positive Query\fi%
    \ifnum#1=7 Negative Query\fi%
}

% Helper macro to plot all objects for a given case
\newcommand{\AddAllObjectPlotsForScaling}[1]{%
    % \htthree (object_id=6)
    \addplot[CuckooLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{6:6},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
    
    % \htfour (object_id=7)
    \addplot[IcebergLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{7:7},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
    
    % \htfive (object_id=15)
    \addplot[JunctionLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{15:15},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
    
    % \htsix (object_id=24)
    \addplot[TBBLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{24:24},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
    
    % \htone (object_id=17)
    \addplot[TPHTLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{17:17},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
    
    % \httwo (object_id=20)
    \addplot[BlastLineStyle] table[
        x=thread_num,
        y expr=\thisrow{throughput (ops/s)}/1000000,
        restrict expr to domain={\thisrow{case_id}}{#1:#1},
        restrict expr to domain={\thisrow{object_id}}{20:20},
        restrict expr to domain={\thisrow{thread_num}}{0:17}
    ] {\scalingdata};
}


\begin{figure*}[h]
    \centering
    % Display shared legend
    {\pgfplotslegendfromname{spaceeff-legend}}
    % Case 1
    \begin{subfigure}[b]{0.27\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=5cm,
                    height=3.2cm,
                    xlabel={Threads},
                    ylabel={Throughput(M/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0,
                    xmax=20,
                    ymin=1,
                    ymax=400,
                    xtick={1,2,4,8,16},
                    xticklabels={1,2,4,8,16},
                    ytick={0.1,1,10,100},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    % title={\getCaseName{1}},
                    % title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{1}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{1}}
    \end{subfigure}%
    % Case 3
    \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=5cm,
                    height=3.2cm,
                    xlabel={Threads},
                    % ylabel={Throughput(M/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0,
                    xmax=20,
                    ymin=1,
                    ymax=1000,
                    xtick={1,2,4,8,16},
                    xticklabels={1,2,4,8,16},
                    ytick={0.1,1,10,100,1000},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    % title={\getCaseName{3}},
                    % title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{3}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{3}}
    \end{subfigure}%
    % Case 6
    \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=5cm,
                    height=3.2cm,
                    xlabel={Threads},
                    % ylabel={Throughput(M/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0,
                    xmax=20,
                    ymin=1,
                    ymax=1000,
                    xtick={1,2,4,8,16},
                    xticklabels={1,2,4,8,16},
                    ytick={0.1,1,10,100,1000},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    % title={\getCaseName{6}},
                    % title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]
                \AddAllObjectPlotsForScaling{6}
            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{6}}
    \end{subfigure}%
    % Case 7
    \begin{subfigure}[b]{0.24\textwidth}
        \centering
        \begin{tikzpicture}
            \begin{axis}[
                    width=5cm,
                    height=3.2cm,
                    xlabel={Threads},
                    % ylabel={Throughput(M/s)},
                    xmode=log,
                    ymode=log,
                    log basis x=2,
                    log basis y=10,
                    xmin=0,
                    xmax=20,
                    ymin=1,
                    ymax=1000,
                    xtick={1,2,4,8,16},
                    xticklabels={1,2,4,8,16},
                    ytick={0.1,1,10,100,1000},
                    grid=major,
                    grid style={gray!30},
                    tick label style={font=\small},
                    label style={font=\small},
                    % title={\getCaseName{7}},
                    % title style={font=\small},
                    scaled ticks=true,
                    tick label style={/pgf/number format/fixed,/pgf/number format/precision=1}
                ]

                \AddAllObjectPlotsForScaling{7}

            \end{axis}
        \end{tikzpicture}
        \caption{\getCaseName{7}}
    \end{subfigure}%
    \caption{Performance scaling analysis for hash tables with increasing number of threads for 64M insertions.}
    \label{fig:scaling_analysis}
\end{figure*}